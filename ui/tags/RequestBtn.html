<button class="btn waves-effect waves-light yellow black-text {disabled}" on:click=send(event)>
    <slot><!-- btn text --></slot>
</button>


<script>
export default {
    data() {
        return {
            disabled: false,
            body: {}, // you can fill this
            bodyById: null, // list of DOM input element IDs to make body from their values
            get: null,
            post: null,
            response: null, // bind:response if you need the response
        }
    },
    methods: {
        send(e) {
            // prevent the page from reloading
				e.preventDefault();
            function handle(err) {
                // TODO handle err properly !
                this.set({ response: { err }, disabled: false })
            }
            this.set({disabled: true});
            var {get, post, body, bodyById} = this.get();
            if(bodyById) {
                for(var i of bodyById) {
                    body[i] = document.getElementById(i).value;
                }
            }
            if(post) {
                return fetch(post, {
                    method: "POST",
                    mode: "same-origin",
                    credentials: "same-origin",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    redirect: "follow",
                    body: JSON.stringify(body)
                })
                .then(response => {
                    if(response.redirected) {
                        window.location.href = response.url;
                        return {json:()=>({})};
                    }
                    return response
                })
                .then(response => {
                    var contentType = response.headers.get("content-type");
                    if(contentType && contentType.includes("application/json")) {
                        return response.json();
                    }
                    throw new TypeError("response is not JSON");
                })
                .then(json => this.set({ response: json, disabled: false }))
                .catch(handle);
            } else if(get) {
                // make urlencoded
                get += "?";
                for(var i of body) {
                    get += `${i}=${body[i]}&`;
                }
                return fetch(get, {
                    method: "GET",
                    mode: "same-origin",
                    credentials: "same-origin",
                    headers: {
                        "Content-Type": "application/x-www-form-urlencoded"
                    },
                    redirect: "follow",
                })
                .then(response => {
                    if(response.redirected) {
                        window.location.href = response.url;
                        return {json:()=>({})};
                    }
                    return response
                })
                .then(response => {
                    var contentType = response.headers.get("content-type");
                    if(contentType && contentType.includes("application/json")) {
                        return response.json();
                    }
                    throw new TypeError("response is not JSON");
                })
                .then(json => this.set({ response: json, disabled: false }))
                .catch(handle);
            }
        }
    }
}
</script>