<svelte:head>
    <title>{title}</title>
</svelte:head>
<div class="container">
    <div class="row">
        <Card col="s10 offset-s1 m4 offset-m4 l6 offset-l3" image="/public/img/cds.svg" alt="logo">
            <Form>

                <Input col="s6" label="First name" id="firstname" type="text" />
                <Input col="s6" label="Last name" id="lastname" type="text" />
                <Input col="s12" label="Email" id="email" type="email" />
                <Input col="s12" label="Password" id="password" type="password" validate helper
                    data-empty="Password is required" />
                <Input col="s12" label="Comfirm Password" id="Cpass" type="password" validate helper
                    data-empty="Comfirmd password is required" />
                <label>
                    <input type="checkbox" id="telegram" />
                    <span>قبول داری؟؟</span>
                </label><br />
                <br />
                <a class="waves-effect waves-light yellow black-text btn" on:click=post()>Register</a>
            </Form>
        </Card>
    </div>
</div>
<script>
    const utils = {
        toast(html) {
            M.toast({ html });
        }
    }
    export default {
        data() {
            return {
                response: null
            };
        },
        methods: {
            post() {

                var cpass = document.getElementById("Cpass").value;
                var pass = document.getElementById("password").value;
                var formdata = {
                    "firstname": `${document.getElementById("firstname").value}`,
                    "lastname": `${document.getElementById("lastname").value}`,
                    "email": `${document.getElementById("email").value}`,
                    "password": `${pass}`
                }

                if (formdata.email == null || formdata.firstname == null || formdata.lastname == null || formdata.password || Cpass) {
                    utils.toast("Length Required !")
                }
                else if (cpass != pass) {
                    utils.toast("Password and Confirm Doesn't Match !")
                }
                else {
                    fetch("/user/register", {
                        method: "POST",
                        mode: "same-origin",
                        credentials: "same-origin",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        redirect: "follow",
                        body: JSON.stringify(formdata)
                    }).then(res => {
                        if (res.status == 200) {
                            if (res.redirected) {
                                window.location.href = res.url;
                            }
                        }
                        else {
                            utils.toast("Something went wrong !")
                        }
                    })
                }

            }
        },
        oncreate() {
            M.AutoInit();
            window.utils = utils
        },
        components: {
            Card: "../tags/Card.html",
            Form: "../tags/Form.html",
            Input: "../tags/Input.html",
            RequestBtn: "../tags/RequestBtn.html"
        }

    }

</script>