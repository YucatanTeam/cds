<svelte:head>
	<title>{title}</title>
</svelte:head>



<div class="row">
	<Sidenav background="/public/img/cds.svg" fixed> <!-- TODO : fill the background with user avatar -->
		
		{#await getuser}
			<Loading small/>
		{:then user}
			<li><a class="truncate" href="#/AbroadControlCenter"><I>language</I>Abroad Control Center</a></li>
			<li><a class="truncate" href="#/AccessControlCenter"><I>accessibility</I>Access Control Center</a></li>
			<li><a class="truncate" href="#/AnswerQuestionControlCenter"><I>question_answer</I>FAQ Control Center</a></li>
			<li><a class="truncate" href="#/SandBox"><I>devices</I>Sand Box</a></li>
			<li><a class="truncate" href="#/CandoServices"><I>store</I>Cando Services</a></li>
			<li><a class="truncate" href="#/CertificateControlCenter"><I>fingerprint</I>Certificate Control Center</a></li>
			<li><a class="truncate" href="#/ConsultancyServices"><I>live_help</I>Consultancy Services</a></li>
			<li><a class="truncate" href="#/MagazineControlCenter"><I>import_contacts</I>Magazine Control Center</a></li>
			<li><a class="truncate" href="#/CommentControlCenter"><I>comment</I>Comment Control Center</a></li>
			<li><a class="truncate" href="#/Modules"><I>bubble_chart</I>Modules</a></li>
			<li><a class="truncate" href="#/SecurityPolicy"><I>security</I>Security Policy</a></li>
			<li><a class="truncate" href="#/SeoSetup"><I>search</I>Seo Setup</a></li>
			<li><a class="truncate" href="#/StudentControlCenter"><I>assignment_ind</I>Student Control Center</a></li>
		{:catch err}
			<p>Error {err.code}</p>
		{/await}
	</Sidenav>
	<div class="col offset-l3">
		<div class="container">
			<Router routes={routes}>
				<div class="error">
					This page was not found.
				</div>
			</Router>
		</div>
	</div>
</div>

<script>
	import SecurityPolicy from "./admin_pages/SecurityPolicy.html";
	import CandoServices from "./admin_pages/CandoServices.html";
	import AccessControlCenter from "./admin_pages/AccessControlCenter.html";
	import AbroadControlCenter from "./admin_pages/AbroadControlCenter.html";
	import AnswerQuestionControlCenter from "./admin_pages/AnswerQuestionControlCenter.html";
	import CertificateControlCenter from "./admin_pages/CertificateControlCenter.html";
	import ConsultancyServices from "./admin_pages/ConsultancyServices.html";
	import MagazineControlCenter from "./admin_pages/MagazineControlCenter.html";
	import Modules from "./admin_pages/Modules.html";
	import SeoSetup from "./admin_pages/SeoSetup.html";
	import StudentControlCenter from "./admin_pages/StudentControlCenter.html";
	import CommentControlCenter  from "./admin_pages/CommentControlCenter.html";
	import SandBox from "./admin_pages/SandBox.html";

	const utils = {
		// to follow redirect after a fetch
		followRedirect(response) {
			if(response.redirected) {
				window.location.href = response.url;
			}
			return response;
		},
		fetch(src, postBody) {
			return (
				fetch(src, postBody ? {
                    method: "POST",
                    mode: "same-origin",
                    credentials: "same-origin",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    redirect: "follow",
                    body: JSON.stringify(postBody)
                } : {
                    method: "GET",
                    mode: "same-origin",
                    credentials: "same-origin",
                    headers: {
                        "Content-Type": "application/x-www-form-urlencoded"
                    },
                    redirect: "follow",
                })
				.then(response => {
                    if(response.redirected) {
                        window.location.href = response.url;
                    }
                    return response;
                })
                .then(response => {
                    var contentType = response.headers.get("content-type");
                    if(contentType && contentType.includes("application/json")) {
                        return response.json().then(json => ({status: response.status, body: json.body}));
                    }
                    return {status: response.status, body: null};
                })
			)
		}
	};

	export default {
	  	oncreate() {
			M.AutoInit();
			window.utils = utils;
		},
	  	data() {
			return {
				getuser:
					utils.fetch("/getuser")
					.then(user=>{
						window.cdsuser = user;
						return user;
					}),
				title: "CDS-PANEL",
				routes: {
				'/SecurityPolicy': [SecurityPolicy, {message: 'from "/SecurityPolicy" path'}],
				'/CandoServices': [CandoServices, {message: 'from "/CandoServices" path'}],
				'/AccessControlCenter': [AccessControlCenter, {message: 'from "/AccessControlCenter" path'}],
				'/AbroadControlCenter': [AbroadControlCenter, {message: 'from "/AbroadControlCenter" path'}],
				'/AnswerQuestionControlCenter': [AnswerQuestionControlCenter, {message: 'from "/AnswerQuestionControlCenter" paht'}],
				'/CertificateControlCenter': [CertificateControlCenter, {message: 'from "/CertificateControlCenter" path'}],
				'/ConsultancyServices': [ConsultancyServices, {message: 'from "/ConsultancyServices" path'}],
				'/MagazineControlCenter': [MagazineControlCenter, {message: 'from "/MagazineControlCenter" path'}],
				'/Modules': [Modules, {message: 'from "/Modules" path'}],
				'/SeoSetup': [SeoSetup, {message: 'from "/SeoSetup" path'}],
				'/StudentControlCenter': [StudentControlCenter, {message: 'from "/StudentControlCenter" path'}],
				'/CommentControlCenter': [CommentControlCenter, {message: 'from "/CommetControlCenter" path'}],
				'/SandBox': [SandBox, {message: 'from "/SandBox" path'}]
				}
			};
		},
		components: {
			Router: "svelte-app-router",
			Sidenav: "../tags/Sidenav.html",
			I: '../tags/Icon.html',
			Loading: '../tags/Loading.html'
	  	}
	};
</script>