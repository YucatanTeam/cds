
<!-- 
    actions :
        is a list of bool pushed at the end of each row on server side 
        there are 4 actions are available  :
            CREATE , DELETE , EDIT , BLOCK/UNBLOCK STATUS        
-->


<!-- TODO :
          save method(see its TODOs) , 
          ckeditor , timeago , tags , 
          show some words of content not the whole in table -->


<h5>{message}</h5>
<hr>
<!-- set actions and bind content  -->
<div class="row">
    {#await getcomments}
        <Loading small/>
    {:then comments}

            <!-- ======== THIS MODAL WILL TRIGGER ON edit & create ACTION OF EACH ROW ======== -->
            <div id="{crudindex===1 ? "modaledit" : "modalcreate"}" class="modal">
                <div class="modal-content">
                    <h4>{crudindex===1 ? "Edit" : "Create"}</h4>

                    {#if objModal}
                        <p>{objModal.id}</p>
                    {/if}
                
                </div>
                <div class="modal-footer">
                    <button class="modal-close waves-effect waves-green btn-flat" on:click="save(objModal)">{crudindex===1 ? "Update" : "Add"}</button>
                </div>
            </div>

        <Table indexed highlight rows={1}
            on:modal="open(event)"
            content={comments}
            search={["name", "content", "email", "cuid", "id", "post_id"]}
            actions={[
                                            /* ------------------------------------------
                                                list of all actions for comment data table 
                                            ------------------------------------------
                                            */
                    // ==============================================================================================
                    // CREATE : only for dev ( must chek on server side using user access inside comment api routes )
                    // ==============================================================================================
                    {icon: "fiber_new",tooltip: "create", action(obj, component) {
                            var index = 0
                            component.fire("modal", {obj, index})
                        }
                    }, 
                    // ==============================================================================================
                    // DELETE
                    // ==============================================================================================
                    {icon: "delete",tooltip: "delete", action(obj, component) {

                           //utils.fetch(`/comment/delete/${obj.cuid}`).then(r=>r.body);
                            
                        }
                    }, 
                    // ==============================================================================================
                    // EDIT
                    // ==============================================================================================
                    {icon: "edit",tooltip: "edit", action(obj, component) {
                            var index = 1
                            component.fire("modal", {obj, index})    
                        }
                    }, 
                    // ==============================================================================================
                    // BLOCK/UNBLOCK STATUS
                    // ==============================================================================================
                        {icon: "block",tooltip: "block", action(obj, component) {
                            
                            
                        }
                    }, 
                ]}
        />
    {:catch err}
        <p>Error {err.code}</p>
    {/await}
</div>

<script>
export default {
    data(){
        return {
            objModal: null,
            crudindex: 0, // 1 : edit , 0 : create
            getcomments: utils.fetch("/comment/getAll").then(r=>r.body)

        }
    },
    methods:{
        open({obj, index}){
            // console.log(obj) // it'll log successfully
            this.set({crudindex: index, objModal: obj})
            var elems = document.querySelector('.modal');
            var instances = M.Modal.init(elems, {});
            instances.open();
        },
        save(obj){
            console.log(`inside saving method.. got new body >>> ${obj}`) // TODO : bug!!!
            // TODO use utils.fetch() to send new obj to the server
            // TODO validate obj on client side and alert if needed
            // remember to validate the obj on server side also
        }
    },
    components: {
        Loading: "../../tags/Loading.html",
        Table: "../../tags/Table.html",
    }
}
</script>